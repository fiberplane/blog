---
import '@fontsource/geist-sans/400.css';
import '@fontsource/geist-sans/500.css';
import '@fontsource/geist-sans/600.css';
import '@fontsource/geist-sans/700.css';
import '@fontsource/geist-mono/400.css';

interface Props {
  title: string;
  description: string;
}

const { title, description } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" href="/favicon-light.svg" media="(prefers-color-scheme: light)" />
    <link rel="icon" href="/favicon-dark.svg" media="(prefers-color-scheme: dark)" />
    <meta name="generator" content={Astro.generator} />
    <title>{title} | Fiberplane Blog</title>
  </head>
  <body>
    <header class="site-header">
      <nav class="nav-container">
        <a href="/" class="logo">
          <img src="/logo.svg" alt="Fiberplane" />
        </a>
        <div class="nav-links">
          <a href="/" class="nav-link">Blog</a>
          <a href="https://docs.fiberplane.com" class="nav-link">Docs</a>
          <div class="theme-toggle">
            <button class="theme-button" data-theme="auto" aria-label="Auto theme">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="9" y1="3" x2="9" y2="21"></line>
              </svg>
            </button>
            <button class="theme-button" data-theme="light" aria-label="Light theme">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
              </svg>
            </button>
            <button class="theme-button" data-theme="dark" aria-label="Dark theme">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
              </svg>
            </button>
          </div>
        </div>
      </nav>
    </header>
    <main>
      <slot />
    </main>
    <footer class="site-footer">
      <p>&copy; {new Date().getFullYear()} Fiberplane. All rights reserved.</p>
    </footer>
  </body>
</html>

<script>
  // Theme toggle functionality
  function getThemePreference() {
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      return localStorage.getItem('theme');
    }
    return 'auto';
  }

  function setTheme(theme: string) {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme');
    } else {
      document.documentElement.setAttribute('data-theme', theme);
    }
    localStorage.setItem('theme', theme);

    // Update active button
    document.querySelectorAll('.theme-button').forEach((button) => {
      button.classList.remove('active');
    });
    const activeButton = document.querySelector(`[data-theme="${theme}"]`);
    if (activeButton) {
      activeButton.classList.add('active');
    }
  }

  // Initialize theme on page load
  document.addEventListener('DOMContentLoaded', () => {
    const theme = getThemePreference();
    setTheme(theme);

    // Add click handlers
    document.querySelectorAll('.theme-button').forEach((button) => {
      button.addEventListener('click', () => {
        const theme = button.getAttribute('data-theme');
        if (theme) {
          setTheme(theme);
        }
      });
    });
  });

  // Handle page navigation (for view transitions or SPA-like behavior)
  document.addEventListener('astro:page-load', () => {
    const theme = getThemePreference();
    setTheme(theme);
  });
</script>

<style is:global>
  :root {
    /* Light mode colors */
    --color-text: hsl(0, 0%, 35%);
    --color-text-secondary: hsl(0, 0%, 55%);
    --color-heading: hsl(0, 0%, 10%);
    --color-bg: hsl(0, 0%, 100%);
    --color-bg-secondary: hsl(0, 0%, 99%);
    --color-border: hsl(0, 0%, 90%);
    --color-accent: hsl(212, 100%, 50%);
    --color-accent-dark: hsl(212, 100%, 45%);
    --color-accent-light: hsl(212, 100%, 96%);

    /* Code block colors - light theme */
    --color-code-bg: hsl(0, 0%, 96%);
    --color-code-border: hsl(0, 0%, 88%);
  }

  /* Dark mode - auto (system preference) */
  @media (prefers-color-scheme: dark) {
    :root:not([data-theme="light"]) {
      /* Dark mode colors */
      --color-text: hsl(0, 0%, 82%);
      --color-text-secondary: hsl(0, 0%, 65%);
      --color-heading: hsl(0, 0%, 98%);
      --color-bg: hsl(0, 0%, 5%);
      --color-bg-secondary: hsl(0, 0%, 8%);
      --color-border: hsl(0, 0%, 20%);
      --color-accent: hsl(212, 100%, 60%);
      --color-accent-dark: hsl(212, 100%, 70%);
      --color-accent-light: hsl(212, 100%, 15%);

      /* Code block colors - dark theme */
      --color-code-bg: hsl(0, 0%, 10%);
      --color-code-border: hsl(0, 0%, 25%);
    }
  }

  /* Dark mode - manual */
  :root[data-theme="dark"] {
    /* Dark mode colors */
    --color-text: hsl(0, 0%, 82%);
    --color-text-secondary: hsl(0, 0%, 65%);
    --color-heading: hsl(0, 0%, 98%);
    --color-bg: hsl(0, 0%, 5%);
    --color-bg-secondary: hsl(0, 0%, 8%);
    --color-border: hsl(0, 0%, 20%);
    --color-accent: hsl(212, 100%, 60%);
    --color-accent-dark: hsl(212, 100%, 70%);
    --color-accent-light: hsl(212, 100%, 15%);

    /* Code block colors - dark theme */
    --color-code-bg: hsl(0, 0%, 10%);
    --color-code-border: hsl(0, 0%, 25%);
  }

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  html {
    font-family: 'Geist Sans', system-ui, sans-serif;
    background-color: var(--color-bg);
    color: var(--color-text);
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  body {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* Smooth transitions for theme changes */
  *,
  *::before,
  *::after {
    transition-property: background-color, border-color, color, fill, stroke;
    transition-duration: 0.3s;
    transition-timing-function: ease;
  }

  main {
    flex: 1;
  }

  /* Header styles */
  .site-header {
    border-bottom: 1px solid var(--color-border);
    background-color: var(--color-bg);
  }

  .nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1rem 2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .logo {
    display: inline-block;
  }

  .nav-links {
    display: flex;
    gap: 2rem;
    align-items: center;
  }

  .nav-link {
    color: var(--color-text);
    text-decoration: none;
    font-size: 0.9375rem;
    font-weight: 500;
    transition: color 0.2s ease;
  }

  .nav-link:hover {
    color: var(--color-heading);
  }

  .theme-toggle {
    display: flex;
    gap: 0;
    background-color: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: 9999px;
    padding: 0.25rem;
    transition: background-color 0.3s ease, border-color 0.3s ease;
  }

  .theme-button {
    background: none;
    border: none;
    padding: 0.5rem;
    cursor: pointer;
    color: var(--color-text-secondary);
    border-radius: 9999px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
    width: 32px;
    height: 32px;
  }

  .theme-button:hover {
    color: var(--color-heading);
  }

  .theme-button.active {
    background-color: var(--color-bg);
    color: var(--color-heading);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .logo img {
    height: auto;
    width: 100px;
    transition: filter 0.3s ease;
  }

  /* Invert logo in light mode */
  .logo img {
    filter: invert(1);
  }

  /* Don't invert in dark mode (auto with dark system preference) */
  @media (prefers-color-scheme: dark) {
    :root:not([data-theme="light"]) .logo img {
      filter: invert(0);
    }
  }

  /* Don't invert in manual dark mode */
  :root[data-theme="dark"] .logo img {
    filter: invert(0);
  }

  /* Syntax highlighting - use CSS variables for theme switching */
  .astro-code {
    background-color: var(--color-code-bg) !important;
  }

  /* Switch to dark theme colors in dark mode (auto with dark system preference) */
  @media (prefers-color-scheme: dark) {
    :root:not([data-theme="light"]) .astro-code {
      background-color: var(--shiki-dark-bg) !important;
    }
    :root:not([data-theme="light"]) .astro-code span {
      color: var(--shiki-dark) !important;
    }
  }

  /* Switch to dark theme colors in manual dark mode */
  :root[data-theme="dark"] .astro-code {
    background-color: var(--shiki-dark-bg) !important;
  }
  :root[data-theme="dark"] .astro-code span {
    color: var(--shiki-dark) !important;
  }

  /* Footer styles */
  .site-footer {
    border-top: 1px solid var(--color-border);
    padding: 2rem;
    text-align: center;
    color: var(--color-text-secondary);
    font-size: 0.875rem;
  }
</style>
